<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome图标 -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1', // 主色调：靛蓝色
                        secondary: '#10B981', // 辅助色：绿色
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .player-shadow {
                box-shadow: 0 8px 30px rgba(99, 102, 241, 0.15);
            }
            .song-hover {
                transition: all 0.3s ease;
            }
            .song-hover:hover {
                transform: translateX(4px);
            }
            .progress-thumb {
                @apply w-3 h-3 bg-primary rounded-full absolute -top-1/3 opacity-0 transition-opacity duration-300;
            }
            .progress-container:hover .progress-thumb {
                opacity: 1;
            }
            .search-focus {
                @apply border-primary ring-2 ring-primary/20;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-inter text-gray-800">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 页面标题 -->
        <header class="text-center mb-8">
            <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-primary mb-2">
                <i class="fa fa-music mr-3"></i>音乐播放器
            </h1>
            <p class="text-gray-600 text-lg">2025运动会音乐汇总</p>
        </header>
        
        <!-- 主内容区 -->
        <main class="flex flex-col lg:flex-row gap-6">
            <!-- 歌曲列表区域 -->
            <div class="lg:w-1/2 bg-white rounded-2xl p-5 player-shadow">
                <div class="mb-4">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-list-ul mr-2 text-primary"></i>歌曲列表
                        <span class="ml-2 text-sm text-gray-500 font-normal">共 <span id="songCount">0</span> 首</span>
                    </h2>
                    
                    <!-- 搜索框 -->
                    <div class="relative mb-4">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="搜索歌曲或歌手..." 
                            class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 focus:outline-none focus:search-focus transition-all"
                        >
                        <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <button id="clearSearch" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div id="searchResults" class="text-sm text-gray-500 mb-2 hidden">
                        找到 <span id="matchCount">0</span> 首匹配的歌曲
                    </div>
                </div>
                
                <div id="songList" class="space-y-2 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-200 scrollbar-track-transparent">
                    <!-- 歌曲列表将通过JavaScript动态生成 -->
                </div>
                
                <!-- 没有搜索结果时显示 -->
                <div id="noResults" class="text-center py-10 text-gray-500 hidden">
                    <i class="fa fa-search-minus text-4xl mb-2 opacity-50"></i>
                    <p>没有找到匹配的歌曲</p>
                </div>
            </div>
            
            <!-- 播放器控制区域 -->
            <div class="lg:w-1/2 bg-white rounded-2xl p-5 player-shadow flex flex-col">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-headphones mr-2 text-primary"></i>正在播放
                </h2>
                
                <!-- 当前播放信息和专辑封面 -->
                <div class="mb-6 text-center">
                    <div class="w-56 h-56 mx-auto bg-primary/10 rounded-full flex items-center justify-center mb-4 relative group">
                        <div id="albumCover" class="w-48 h-48 rounded-full overflow-hidden">
                            <img src="https://picsum.photos/200/200" alt="专辑封面" class="w-full h-full object-cover">
                        </div>
                        <!-- 旋转动画效果 -->
                        <div class="absolute inset-0 rounded-full border-4 border-primary/20 border-t-primary hidden group-hover:block" style="animation: spin 3s linear infinite;"></div>
                    </div>
                    <h3 class="text-lg font-medium truncate" id="currentTitle">未播放音乐</h3>
                    <p class="text-gray-500 text-sm" id="currentArtist">点击列表中的歌曲开始播放</p>
                </div>
                
                <!-- 进度条 -->
                <div class="mb-6">
                    <div class="flex justify-between text-sm text-gray-500 mb-1">
                        <span id="currentTime">00:00</span>
                        <span id="totalTime">00:00</span>
                    </div>
                    <div class="progress-container relative h-2 bg-gray-200 rounded-full cursor-pointer group">
                        <div id="progressBar" class="absolute top-0 left-0 h-full bg-primary rounded-full w-0 transition-all duration-150"></div>
                        <div class="progress-thumb" id="progressThumb"></div>
                    </div>
                </div>
                
                <!-- 控制按钮 -->
                <div class="flex items-center justify-between mb-6 px-4">
                    <button id="shuffleBtn" class="text-gray-500 hover:text-primary transition-colors p-2">
                        <i class="fa fa-random text-xl"></i>
                    </button>
                    <button id="prevBtn" class="text-gray-700 hover:text-primary transition-colors p-2">
                        <i class="fa fa-step-backward text-2xl"></i>
                    </button>
                    <button id="playPauseBtn" class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center hover:bg-primary/90 transition-all hover:scale-105 active:scale-95 shadow-lg shadow-primary/20">
                        <i class="fa fa-play text-2xl"></i>
                    </button>
                    <button id="nextBtn" class="text-gray-700 hover:text-primary transition-colors p-2">
                        <i class="fa fa-step-forward text-2xl"></i>
                    </button>
                    <button id="repeatBtn" class="text-gray-500 hover:text-primary transition-colors p-2">
                        <i class="fa fa-repeat text-xl"></i>
                    </button>
                </div>
                
                <!-- 播放模式显示 -->
                <div class="mt-auto text-center text-sm text-gray-500 py-2">
                    <p>播放模式: <span id="modeDisplay" class="font-medium text-primary">列表循环</span></p>
                </div>
            </div>
        </main>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>&copy; 2605 胡胜杰</p>
        </footer>
    </div>
    
    <!-- 音频元素 -->
    <audio id="audioPlayer" preload="metadata"></audio>
    
    <script>
        // 播放器状态
        const playerState = {
            currentSongIndex: -1,
            isPlaying: false,
            repeatMode: "list", // list:列表循环, single:单曲循环, shuffle:乱序播放
            playedSongs: new Set(), // 用于乱序播放时记录已播放的歌曲
            allSongs: [], // 存储所有歌曲
            filteredSongs: [] // 存储搜索过滤后的歌曲
        };
        
        // DOM元素引用
        const audioPlayer = document.getElementById('audioPlayer');
        const songListElement = document.getElementById('songList');
        const songCountElement = document.getElementById('songCount');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const progressBar = document.getElementById('progressBar');
        const progressThumb = document.getElementById('progressThumb');
        const currentTimeElement = document.getElementById('currentTime');
        const totalTimeElement = document.getElementById('totalTime');
        const currentTitleElement = document.getElementById('currentTitle');
        const currentArtistElement = document.getElementById('currentArtist');
        const modeDisplayElement = document.getElementById('modeDisplay');
        const albumCoverElement = document.getElementById('albumCover').querySelector('img');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearch');
        const searchResultsElement = document.getElementById('searchResults');
        const matchCountElement = document.getElementById('matchCount');
        const noResultsElement = document.getElementById('noResults');
        
        // 初始化播放器
        function init() {
            // 加载歌曲数据
            loadSongsData();
            
            // 添加事件监听器
            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', playPrevious);
            nextBtn.addEventListener('click', playNext);
            repeatBtn.addEventListener('click', changeRepeatMode);
            shuffleBtn.addEventListener('click', toggleShuffle);
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('loadedmetadata', updateTotalTime);
            audioPlayer.addEventListener('ended', handleSongEnd);
            document.querySelector('.progress-container').addEventListener('click', seek);
            
            // 搜索相关事件
            searchInput.addEventListener('input', handleSearch);
            clearSearchBtn.addEventListener('click', clearSearch);
            searchInput.addEventListener('focus', () => searchInput.classList.add('search-focus'));
            searchInput.addEventListener('blur', () => {
                if (!searchInput.value) {
                    searchInput.classList.remove('search-focus');
                }
            });
            
            // 初始化动画
            addAnimationKeyframes();
        }
        
        // 从JSON文件加载歌曲数据
        function loadSongsData() {
            fetch('songs.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('无法加载歌曲数据');
                    }
                    return response.json();
                })
                .then(data => {
                    playerState.allSongs = data;
                    playerState.filteredSongs = [...data]; // 初始时显示所有歌曲
                    songCountElement.textContent = data.length;
                    renderSongList();
                })
                .catch(error => {
                    console.error('加载歌曲数据失败:', error);
                    // 显示错误信息
                    songListElement.innerHTML = `
                        <div class="text-center py-8 text-red-500">
                            <i class="fa fa-exclamation-triangle mb-2"></i>
                            <p>无法加载歌曲列表，请检查songs.json文件是否存在</p>
                        </div>
                    `;
                });
        }
        
        // 添加旋转动画
        function addAnimationKeyframes() {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                .playing-animation {
                    animation: spin 15s linear infinite;
                }
            `;
            document.head.appendChild(style);
        }
        
        // 渲染歌曲列表
        function renderSongList() {
            songListElement.innerHTML = '';
            
            // 显示或隐藏搜索结果信息
            if (searchInput.value.trim()) {
                searchResultsElement.classList.remove('hidden');
                matchCountElement.textContent = playerState.filteredSongs.length;
                
                // 显示无结果提示
                if (playerState.filteredSongs.length === 0) {
                    noResultsElement.classList.remove('hidden');
                    return;
                } else {
                    noResultsElement.classList.add('hidden');
                }
            } else {
                searchResultsElement.classList.add('hidden');
                noResultsElement.classList.add('hidden');
            }
            
            playerState.filteredSongs.forEach((song, indexInFiltered) => {
                // 找到在原始列表中的索引
                const originalIndex = playerState.allSongs.findIndex(
                    s => s.src === song.src
                );
                
                const songElement = document.createElement('div');
                songElement.className = `p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors flex justify-between items-center song-hover ${
                    originalIndex === playerState.currentSongIndex ? 'bg-primary/10' : ''
                }`;
                
                // 高亮显示匹配的搜索文本
                let displayTitle = song.title;
                let displayArtist = song.artist;
                const searchTerm = searchInput.value.trim().toLowerCase();
                
                if (searchTerm) {
                    displayTitle = highlightMatch(song.title, searchTerm);
                    displayArtist = highlightMatch(song.artist, searchTerm);
                }
                
                songElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                            <span class="text-primary text-sm">${indexInFiltered + 1}</span>
                        </div>
                        <div class="min-w-0">
                            <div class="font-medium truncate">${displayTitle}</div>
                            <div class="text-sm text-gray-500 truncate">${displayArtist}</div>
                        </div>
                    </div>
                    <i class="fa ${originalIndex === playerState.currentSongIndex ? 'fa-volume-up text-primary' : 'fa-play text-gray-400'}"></i>
                `;
                
                songElement.addEventListener('click', () => playSong(originalIndex));
                songListElement.appendChild(songElement);
            });
        }
        
        // 高亮显示匹配的文本
        function highlightMatch(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="bg-yellow-200">$1</span>');
        }
        
        // 处理搜索
        function handleSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            // 显示或隐藏清除按钮
            if (searchTerm) {
                clearSearchBtn.classList.remove('hidden');
                
                // 过滤歌曲：搜索词与歌名或歌手名有任何匹配的字符
                playerState.filteredSongs = playerState.allSongs.filter(song => {
                    const titleMatch = song.title.toLowerCase().includes(searchTerm);
                    const artistMatch = song.artist.toLowerCase().includes(searchTerm);
                    return titleMatch || artistMatch;
                });
            } else {
                clearSearchBtn.classList.add('hidden');
                // 没有搜索词时显示所有歌曲
                playerState.filteredSongs = [...playerState.allSongs];
            }
            
            renderSongList();
        }
        
        // 清除搜索
        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.classList.add('hidden');
            searchInput.classList.remove('search-focus');
            playerState.filteredSongs = [...playerState.allSongs];
            renderSongList();
        }
        
        // 播放指定歌曲
        function playSong(index) {
            if (index < 0 || index >= playerState.allSongs.length) return;
            
            // 更新当前歌曲索引
            playerState.currentSongIndex = index;
            
            // 加载并播放歌曲
            const song = playerState.allSongs[index];
            audioPlayer.src = song.src;
            
            // 更新专辑封面
            if (song.cover) {
                albumCoverElement.src = song.cover;
            } else {
                albumCoverElement.src = "https://picsum.photos/200/200";
            }
            
            // 播放歌曲
            audioPlayer.play().then(() => {
                playerState.isPlaying = true;
                updatePlayPauseButton();
                updateCurrentSongInfo();
                renderSongList(); // 更新列表高亮
                // 添加播放动画
                albumCoverElement.classList.add('playing-animation');
            }).catch(error => {
                console.error('播放失败:', error);
                alert('无法播放此歌曲，请检查文件路径是否正确。');
            });
        }
        
        // 切换播放/暂停
        function togglePlayPause() {
            if (playerState.currentSongIndex === -1 && playerState.allSongs.length > 0) {
                // 如果没有选中歌曲，从第一首开始播放
                playSong(0);
                return;
            }
            
            if (playerState.isPlaying) {
                audioPlayer.pause();
                albumCoverElement.classList.remove('playing-animation');
            } else {
                audioPlayer.play();
                albumCoverElement.classList.add('playing-animation');
            }
            playerState.isPlaying = !playerState.isPlaying;
            updatePlayPauseButton();
        }
        
        // 播放上一首
        function playPrevious() {
            if (playerState.allSongs.length === 0) return;
            
            let newIndex;
            
            if (playerState.repeatMode === 'shuffle') {
                // 乱序播放模式下，随机选择一首未播放的歌曲
                newIndex = getRandomIndex();
            } else {
                // 正常模式下，上一首
                newIndex = (playerState.currentSongIndex - 1 + playerState.allSongs.length) % playerState.allSongs.length;
            }
            
            playSong(newIndex);
        }
        
        // 播放下一首
        function playNext() {
            if (playerState.allSongs.length === 0) return;
            
            let newIndex;
            
            if (playerState.repeatMode === 'shuffle') {
                // 乱序播放模式下，随机选择一首未播放的歌曲
                newIndex = getRandomIndex();
            } else {
                // 正常模式下，下一首
                newIndex = (playerState.currentSongIndex + 1) % playerState.allSongs.length;
            }
            
            playSong(newIndex);
        }
        
        // 处理歌曲结束
        function handleSongEnd() {
            if (playerState.repeatMode === 'single') {
                // 单曲循环，重新播放当前歌曲
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else {
                // 列表循环或乱序播放，播放下一首
                playNext();
            }
        }
        
        // 改变重复模式（列表循环 <-> 单曲循环）
        function changeRepeatMode() {
            if (playerState.repeatMode === 'list' || playerState.repeatMode === 'shuffle') {
                playerState.repeatMode = 'single';
            } else {
                playerState.repeatMode = 'list';
            }
            
            updateModeDisplay();
        }
        
        // 切换随机播放
        function toggleShuffle() {
            if (playerState.repeatMode === 'shuffle') {
                // 关闭随机播放，恢复列表循环
                playerState.repeatMode = 'list';
            } else {
                // 开启随机播放
                playerState.repeatMode = 'shuffle';
                // 重置已播放歌曲集合
                playerState.playedSongs.clear();
                // 添加当前歌曲到已播放集合
                if (playerState.currentSongIndex !== -1) {
                    playerState.playedSongs.add(playerState.currentSongIndex);
                }
            }
            
            updateModeDisplay();
        }
        
        // 获取随机索引（确保不与当前索引相同，且在乱序模式下尽量不重复）
        function getRandomIndex() {
            if (playerState.allSongs.length <= 1) return 0;
            
            // 如果所有歌曲都已播放过，重置已播放集合
            if (playerState.playedSongs.size >= playerState.allSongs.length - 1) {
                playerState.playedSongs.clear();
                if (playerState.currentSongIndex !== -1) {
                    playerState.playedSongs.add(playerState.currentSongIndex);
                }
            }
            
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * playerState.allSongs.length);
            } while (
                newIndex === playerState.currentSongIndex || 
                playerState.playedSongs.has(newIndex)
            );
            
            // 将新索引添加到已播放集合
            playerState.playedSongs.add(newIndex);
            return newIndex;
        }
        
        // 更新进度条
        function updateProgress() {
            if (isNaN(audioPlayer.duration)) return;
            
            const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progressBar.style.width = `${percent}%`;
            progressThumb.style.left = `${percent}%`;
            
            // 更新当前时间显示
            currentTimeElement.textContent = formatTime(audioPlayer.currentTime);
        }
        
        // 更新总时长
        function updateTotalTime() {
            totalTimeElement.textContent = formatTime(audioPlayer.duration);
        }
        
        // 格式化时间（将秒转换为分:秒格式）
        function formatTime(seconds) {
            if (isNaN(seconds)) return "00:00";
            
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // 进度条点击跳转
        function seek(e) {
            const progressContainer = e.currentTarget;
            const rect = progressContainer.getBoundingClientRect();
            const clickPosition = (e.clientX - rect.left) / rect.width;
            const seekTime = clickPosition * audioPlayer.duration;
            
            audioPlayer.currentTime = seekTime;
        }
        
        // 更新播放/暂停按钮
        function updatePlayPauseButton() {
            const icon = playPauseBtn.querySelector('i');
            if (playerState.isPlaying) {
                icon.className = 'fa fa-pause text-2xl';
            } else {
                icon.className = 'fa fa-play text-2xl';
            }
        }
        
        // 更新模式按钮状态
        function updateModeDisplay() {
            let modeText;
            
            switch (playerState.repeatMode) {
                case 'single':
                    modeText = '单曲循环';
                    repeatBtn.classList.add('text-primary');
                    repeatBtn.classList.remove('text-gray-500');
                    shuffleBtn.classList.remove('text-primary');
                    shuffleBtn.classList.add('text-gray-500');
                    break;
                case 'shuffle':
                    modeText = '乱序播放';
                    shuffleBtn.classList.add('text-primary');
                    shuffleBtn.classList.remove('text-gray-500');
                    repeatBtn.classList.remove('text-primary');
                    repeatBtn.classList.add('text-gray-500');
                    break;
                default:
                    modeText = '列表循环';
                    repeatBtn.classList.remove('text-primary');
                    repeatBtn.classList.add('text-gray-500');
                    shuffleBtn.classList.remove('text-primary');
                    shuffleBtn.classList.add('text-gray-500');
            }
            
            modeDisplayElement.textContent = modeText;
        }
        
        // 更新当前歌曲信息显示
        function updateCurrentSongInfo() {
            const currentSong = playerState.allSongs[playerState.currentSongIndex];
            currentTitleElement.textContent = currentSong.title;
            currentArtistElement.textContent = currentSong.artist;
        }
        
        // 页面加载完成后初始化播放器
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    